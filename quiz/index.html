<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Online MCQ Test</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      background-color: #f5f5f5;
    }
    .quiz-card {
      max-width: 800px;
      margin: 40px auto;
    }
    .option-item input[type="radio"] {
      margin-right: 8px;
    }
    .correct {
      color: #0f5132;
      background-color: #d1e7dd;
    }
    .incorrect {
      color: #842029;
      background-color: #f8d7da;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="start-screen" class="card quiz-card">
      <div class="card-body">
        <h3 class="card-title mb-3">Online MCQ Test</h3>
        <p class="card-text">
          • Total questions in bank: 50<br />
          • You will get 15 random questions in this test.<br />
          • One question will be shown at a time.<br />
          • You can move between questions using Previous and Next.<br />
          • Click Submit Test to finish and view your score.
        </p>
        <button id="start-btn" class="btn btn-primary">Start Test</button>
      </div>
    </div>

    
    <div id="quiz-screen" class="card quiz-card d-none">
      <div class="card-body">
        <div class="d-flex justify-content-between mb-2">
          <span id="question-counter" class="fw-semibold"></span>
        </div>
        <h5 id="question-text" class="mb-3"></h5>
        <div id="options-container" class="list-group mb-3"></div>

        <div class="d-flex justify-content-between">
          <button id="prev-btn" class="btn btn-secondary">Previous</button>
          <div>
            <button id="next-btn" class="btn btn-primary me-2">Next</button>
            <button id="submit-btn" class="btn btn-success">Submit Test</button>
          </div>
        </div>
      </div>
    </div>

    
    <div id="result-screen" class="card quiz-card d-none">
      <div class="card-body">
        <h3 class="mb-3">Test Result</h3>
        <p id="score-summary" class="fs-5"></p>

        <h5 class="mt-4 mb-2">Question Review</h5>
        <div id="review-container"></div>

        <button id="retake-btn" class="btn btn-primary mt-3">Retake Test</button>
      </div>
    </div>
  </div>

  <script>
    
    let fullQuestionBank = [];         
    let quesData = [];                
    let currentIndex = 0;              

   
    let userResponse = [];

   
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

   
    function selectRandomQuestions() {
      const cloned = [...fullQuestionBank];
      shuffle(cloned);
      return cloned.slice(0, 15);
    }

    
    function initUserResponse() {
      userResponse = quesData.map((q) => ({
        ques_no: q.id,
        user_answer: null,
        is_correct: false,
      }));
    }

    

    function renderQuestion() {
      const total = quesData.length;
      const qObj = quesData[currentIndex];

      document.getElementById(
        "question-counter"
      ).textContent = `Question ${currentIndex + 1} of ${total}`;

      document.getElementById("question-text").textContent = qObj.question;

      const optionsContainer = document.getElementById("options-container");
      optionsContainer.innerHTML = "";

      const storedAnswer = userResponse[currentIndex].user_answer;

      qObj.options.forEach((opt, idx) => {
        const optionId = `option-${idx}`;
        const optionItem = document.createElement("label");
        optionItem.className =
          "list-group-item list-group-item-action d-flex align-items-center option-item";

        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = "option";
        radio.value = idx;
        radio.id = optionId;
        radio.checked = storedAnswer === idx;

        radio.addEventListener("change", () => {
          handleAnswerSelection(idx);
        });

        const span = document.createElement("span");
        span.textContent = opt;

        optionItem.appendChild(radio);
        optionItem.appendChild(span);
        optionsContainer.appendChild(optionItem);
      });

      
      document.getElementById("prev-btn").disabled = currentIndex === 0;
      document.getElementById("next-btn").disabled =
        currentIndex === total - 1;
    }

    function handleAnswerSelection(selectedIndex) {
      const qObj = quesData[currentIndex];
      const isCorrect = selectedIndex === qObj.answer;

      userResponse[currentIndex].user_answer = selectedIndex;
      userResponse[currentIndex].is_correct = isCorrect;
    }

   
    function calculateScore() {
      let correct = 0;
      let attempted = 0;

      userResponse.forEach((resp) => {
        if (resp.user_answer !== null) {
          attempted++;
          if (resp.is_correct) correct++;
        }
      });

      const total = quesData.length;
      const wrong = attempted - correct;
      const percentage = ((correct / total) * 100).toFixed(2);

      return { total, attempted, correct, wrong, percentage };
    }

    function renderResult() {
      const { total, attempted, correct, wrong, percentage } =
        calculateScore();

      const summaryEl = document.getElementById("score-summary");
      summaryEl.textContent =
        `Total Questions: ${total} | Attempted: ${attempted} | ` +
        `Correct: ${correct} | Wrong: ${wrong} | Score: ${percentage}%`;

      const reviewContainer = document.getElementById("review-container");
      reviewContainer.innerHTML = "";

      quesData.forEach((q, idx) => {
        const resp = userResponse[idx];
        const userAnsIndex = resp.user_answer;
        const correctIndex = q.answer;

        const card = document.createElement("div");
        card.className = "card mb-2";

        const body = document.createElement("div");
        body.className = "card-body";

        const title = document.createElement("h6");
        title.textContent = `Q${idx + 1}. ${q.question}`;
        body.appendChild(title);

        const userAnsText =
          userAnsIndex !== null ? q.options[userAnsIndex] : "Not attempted";
        const correctAnsText = q.options[correctIndex];

        const userP = document.createElement("p");
        userP.textContent = `Your answer: ${userAnsText}`;
        const correctP = document.createElement("p");
        correctP.textContent = `Correct answer: ${correctAnsText}`;

        if (resp.is_correct) {
          userP.classList.add("correct", "p-1");
        } else if (userAnsIndex !== null) {
          userP.classList.add("incorrect", "p-1");
        }

        body.appendChild(userP);
        body.appendChild(correctP);
        card.appendChild(body);
        reviewContainer.appendChild(card);
      });
    }

    

    function showScreen(screenId) {
      document
        .getElementById("start-screen")
        .classList.add("d-none");
      document
        .getElementById("quiz-screen")
        .classList.add("d-none");
      document
        .getElementById("result-screen")
        .classList.add("d-none");

      document.getElementById(screenId).classList.remove("d-none");
    }

    

    document.getElementById("start-btn").addEventListener("click", () => {
      showScreen("quiz-screen");
      currentIndex = 0;
      renderQuestion();
    });

    document.getElementById("prev-btn").addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        renderQuestion();
      }
    });

    document.getElementById("next-btn").addEventListener("click", () => {
      if (currentIndex < quesData.length - 1) {
        currentIndex++;
        renderQuestion();
      }
    });

    document.getElementById("submit-btn").addEventListener("click", () => {
      if (
        !confirm("Are you sure you want to submit the test?")
      ) {
        return;
      }
      showScreen("result-screen");
      renderResult();
    });

    document.getElementById("retake-btn").addEventListener("click", () => {
      
      quesData = selectRandomQuestions();
      initUserResponse();
      currentIndex = 0;
      showScreen("quiz-screen");
      renderQuestion();
    });

    

    async function loadQuestions() {
      try {
        const res = await fetch("questions.json");
        fullQuestionBank = await res.json();
        quesData = selectRandomQuestions();
        initUserResponse();
      } catch (err) {
        alert("Failed to load questions.json. Please check the file path.");
        console.error(err);
      }
    }

    window.addEventListener("load", loadQuestions);
  </script>
</body>
</html>

